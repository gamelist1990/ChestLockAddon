<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Server Control Panel</title>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            /* å…¨ä½“ã®èƒŒæ™¯è‰²ã‚’æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ã« */
            margin: 0;
            padding: 0;
            color: #333;
            /* ãƒ†ã‚­ã‚¹ãƒˆã‚«ãƒ©ãƒ¼ã‚’æ¿ƒã„ã‚°ãƒ¬ãƒ¼ã« */
        }

        .container {
            background-color: #e8e8e8;
            /* ã‚³ãƒ³ãƒ†ãƒŠã®èƒŒæ™¯è‰²ã‚’å°‘ã—æ¿ƒã„ã‚°ãƒ¬ãƒ¼ã« */
            border-radius: 8px;
            /* è§’ä¸¸ã‚’å°‘ã—å¤§ãã */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            /* å½±ã‚’å¼·èª¿ */
            padding: 30px;
            /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¢—åŠ  */
            margin: 30px auto;
            /* ãƒãƒ¼ã‚¸ãƒ³ã‚’å¢—åŠ  */
            max-width: 900px;
            /* ã‚³ãƒ³ãƒ†ãƒŠã®æœ€å¤§å¹…ã‚’å¢—åŠ  */
        }

        h1,
        h2 {
            text-align: center;
            color: #444;
            /* ã‚¿ã‚¤ãƒˆãƒ«ã®è‰²ã‚’å°‘ã—æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ã« */
            margin-bottom: 20px;
            /* ãƒãƒ¼ã‚¸ãƒ³ã‚’èª¿æ•´ */
        }

        h2 {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        h2 .login-icon,
        h2 .server-icon,
        h2.status-icon {
            margin-right: 10px;
            color: #666;
            /* ã‚¢ã‚¤ã‚³ãƒ³ã®è‰²ã‚’å°‘ã—æ˜ã‚‹ã */
        }

        /* Navigation */
        .hamburger-menu {
            position: fixed;
            top: 20px;
            left: 20px;
            cursor: pointer;
            z-index: 100;
            display: none;
        }

        .hamburger-menu div {
            width: 30px;
            height: 4px;
            background-color: #fff;
            /* ç™½è‰²ã«å¤‰æ›´ */
            margin: 6px 0;
            transition: 0.4s;
        }

        #main-nav {
            position: fixed;
            top: 0;
            left: -250px;
            width: 250px;
            height: 100%;
            background-color: #444;
            /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã®èƒŒæ™¯è‰²ã‚’æ¿ƒã„ã‚°ãƒ¬ãƒ¼ã« */
            z-index: 99;
            transition: left 0.3s ease;
            overflow-y: auto;
        }

        #main-nav.active {
            left: 0;
        }

        #main-nav ul {
            list-style: none;
            padding: 0;
            margin-top: 60px;
        }

        #main-nav li {
            padding: 15px;
            color: #f5f5f5;
            /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆè‰²ã‚’æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ã« */
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
        }

        #main-nav li:hover {
            background-color: #666;
            /* ãƒ›ãƒãƒ¼æ™‚ã®èƒŒæ™¯è‰²ã‚’å°‘ã—æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ã« */
        }

        .nav-icon {
            margin-right: 10px;
        }

        /* Login Form */
        #login-form {
            text-align: center;
        }

        #login-form input[type="text"],
        #login-form input[type="password"] {
            padding: 12px;
            /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¢—åŠ  */
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 6px;
            /* è§’ä¸¸ã‚’èª¿æ•´ */
            width: 95%;
            /* inputã®å¹…ã‚’ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã« */
        }

        #login-form button {
            padding: 12px 25px;
            /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ */
            border: none;
            border-radius: 6px;
            background-color: #666;
            /* ãƒœã‚¿ãƒ³ã®èƒŒæ™¯è‰²ã‚’æ¿ƒã„ã‚°ãƒ¬ãƒ¼ã« */
            color: #f5f5f5;
            /* æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ */
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        #login-form button:hover {
            background-color: #888;
            /* ãƒ›ãƒãƒ¼æ™‚ã®èƒŒæ™¯è‰²ã‚’å°‘ã—æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ã« */
        }

        #login-error {
            color: #d9534f;
            /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è‰²ã‚’èª¿æ•´ */
            margin-top: 10px;
        }

        /* Info Box */
        .info-box {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            /* ãƒãƒ¼ã‚¸ãƒ³ã‚’èª¿æ•´ */
        }

        .info-box div {
            text-align: center;
            font-size: 1.1em;
            color: #555;
            /* ãƒ†ã‚­ã‚¹ãƒˆã®è‰²ã‚’èª¿æ•´ */
        }

        /* Console */
        .console-input-area {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            /* å¹…ã‚’æœ€å¤§é™ã«ä½¿ã† */
        }

        .console-container {
            flex-grow: 1;
            margin-bottom: 15px;
            /* ãƒãƒ¼ã‚¸ãƒ³ã‚’èª¿æ•´ */
        }

        #console {
            width: calc(100% - 40px);
            /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è€ƒæ…®ã—ã¦å¹…ã‚’èª¿æ•´ */
            height: 350px;
            /* é«˜ã•ã‚’èª¿æ•´ */
            background-color: #282c34;
            /* ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®èƒŒæ™¯è‰²ã‚’æ¿ƒã„ã‚°ãƒ¬ãƒ¼ã« */
            color: #00FF00;
            /* ç·‘ã®ãƒ†ã‚­ã‚¹ãƒˆ */
            font-family: 'Courier New', Courier, monospace;
            padding: 20px;
            /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ */
            border: none;
            /* æ ç·šã‚’å‰Šé™¤ */
            border-radius: 6px;
            /* è§’ä¸¸ã‚’èª¿æ•´ */
            overflow-y: scroll;
            resize: none;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
            /* å†…å´ã«å½±ã‚’è¿½åŠ  */
        }

        .input-container {
            display: flex;
            gap: 10px;
        }

        #commandInput {
            flex-grow: 1;
            padding: 12px;
            /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¢—åŠ  */
            border: 1px solid #ccc;
            border-radius: 6px;
            /* è§’ä¸¸ã‚’èª¿æ•´ */
        }

        .console-input-area button {
            padding: 12px 25px;
            /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ */
            border: none;
            border-radius: 6px;
            background-color: #666;
            /* ãƒœã‚¿ãƒ³ã®èƒŒæ™¯è‰²ã‚’æ¿ƒã„ã‚°ãƒ¬ãƒ¼ã« */
            color: #f5f5f5;
            /* æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ */
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .console-input-area button:hover {
            background-color: #888;
            /* ãƒ›ãƒãƒ¼æ™‚ã®èƒŒæ™¯è‰²ã‚’å°‘ã—æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ã« */
        }

        /* Server Status */
        #server-status {
            margin-top: 30px;
            /* ãƒãƒ¼ã‚¸ãƒ³ã‚’èª¿æ•´ */
        }

        .status-info {
            padding: 15px;
            /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ */
            border: 1px solid #ccc;
            border-radius: 6px;
            background-color: #f9f9f9;
        }

        .status-info p {
            margin: 8px 0;
            /* ãƒãƒ¼ã‚¸ãƒ³ã‚’èª¿æ•´ */
            color: #555;
            /* ãƒ†ã‚­ã‚¹ãƒˆã®è‰²ã‚’èª¿æ•´ */
        }

        .status-icon {
            color: #5cb85c;
            /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¢ã‚¤ã‚³ãƒ³ã®è‰²ã‚’èª¿æ•´ */
            margin-right: 5px;
        }

        .status-icon.offline {
            color: #d9534f;
        }

        .status-icon.error {
            color: #f0ad4e;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            right: -300px;
            top: 0;
            width: 300px;
            height: 100%;
            background-color: #444;
            /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®èƒŒæ™¯è‰²ã‚’æ¿ƒã„ã‚°ãƒ¬ãƒ¼ã« */
            z-index: 100;
            transition: right 0.3s ease;
            overflow-y: auto;
            color: #f5f5f5;
            /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒ†ã‚­ã‚¹ãƒˆè‰²ã‚’æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ã« */
            padding-top: 20px;
        }

        .sidebar.active {
            right: 0;
        }

        .sidebar .close-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            cursor: pointer;
            font-size: 24px;
            color: #f5f5f5;
            /* æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ */
        }

        .sidebar h3 {
            color: #f5f5f5;
            /* æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ */
            text-align: center;
            margin-bottom: 20px;
        }

        .player-list {
            list-style: none;
            padding: 0;
        }

        .player-list li {
            background-color: #e8e8e8;
            /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã®é …ç›®ã®èƒŒæ™¯è‰²ã‚’æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ã« */
            color: #333;
            /* æ¿ƒã„ã‚°ãƒ¬ãƒ¼ã®ãƒ†ã‚­ã‚¹ãƒˆ */
            margin: 10px;
            /* ãƒãƒ¼ã‚¸ãƒ³ã‚’èª¿æ•´ */
            padding: 15px;
            /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ */
            border-radius: 6px;
            /* è§’ä¸¸ã‚’èª¿æ•´ */
            font-size: 0.9em;
            border: 1px solid #ccc;
        }

        .player-list li strong {
            font-weight: bold;
        }

        .player-list li+li {
            margin-top: 10px;
        }

        /* Pages */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }
    </style>
</head>

<body>
    <div class="hamburger-menu" onclick="toggleNav()">
        <div></div>
        <div></div>
        <div></div>
    </div>

    <nav id="main-nav">
        <ul>
            <li onclick="showPage('console-page')">
                <span class="nav-icon">ğŸ®</span> ã‚³ãƒ³ã‚½ãƒ¼ãƒ«
            </li>
            <li onclick="showPage('players-page')">
                <span class="nav-icon">ğŸ‘¥</span> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç¢ºèª
            </li>
            <li onclick="showPage('status-page')">
                <span class="nav-icon">ğŸ“Š</span> ã‚µãƒ¼ãƒãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
            </li>
        </ul>
    </nav>

    <div class="sidebar">
        <span class="close-btn" onclick="toggleSidebar()">Ã—</span>
        <h3>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h3>
        <ul class="player-list" id="player-list">
            <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
        </ul>
    </div>

    <div class="container" id="login-form">
        <h2><span class="login-icon">ğŸ”’</span> ãƒ­ã‚°ã‚¤ãƒ³</h2>
        <input type="text" id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" required>
        <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required>
        <button onclick="login()"><span class="login-icon">ãƒ­ã‚°ã‚¤ãƒ³</span></button>
        <div id="login-error"></div>
    </div>

    <div class="page" id="console-page">
        <div class="container">
            <h1><span class="server-icon">ğŸ–¥ï¸</span> Minecraft ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«</h1>
            <div class="info-box">
                <div id="playerCount"><span class="info-icon">ğŸ‘¥</span> ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°: 0</div>
                <div id="uptime"><span class="info-icon">â±ï¸</span> èµ·å‹•æ™‚é–“: ä¸æ˜</div>
            </div>
            <div class="console-input-area">
                <div class="console-container">
                    <textarea id="console" readonly></textarea>
                </div>
                <div class="input-container">
                    <input type="text" id="commandInput" placeholder="ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›...">
                    <button onclick="sendCommand()"> <span class="send-icon">é€ä¿¡</span> </button>
                </div>
            </div>
        </div>
    </div>

    <div class="page" id="players-page">
        <div class="container">
            <h2><span class="server-icon">ğŸ‘¥</span> ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç¢ºèª</h2>
            <div class="info-box">
                <div id="playerCount2"><span class="info-icon">ğŸ‘¥</span> ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°: 0</div>
                <div id="uptime2"><span class="info-icon">â±ï¸</span> èµ·å‹•æ™‚é–“: ä¸æ˜</div>
            </div>
            <ul class="player-list" id="player-list2">
                <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
            </ul>
        </div>
    </div>

    <div class="page" id="status-page">
        <div class="container">
            <h2><span class="status-icon">ğŸ“Š</span> ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèª</h2>
            <button onclick="checkServerStatus()"><span class="status-icon">ğŸ”„</span> çŠ¶æ…‹ç¢ºèª</button>
            <div id="server-status" class="status-info"></div>
        </div>
    </div>

    <script>
        let ws = null;
        let loggedIn = false;
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚’ç®¡ç†ã™ã‚‹é…åˆ—
        let currentPlayers = [];

        // ãƒšãƒ¼ã‚¸ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°
        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById(pageId).style.display = 'block';

            // ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
            const nav = document.getElementById('main-nav');
            nav.classList.remove('active');
        }

        function toggleDisplay() {
            const loginForm = document.getElementById('login-form');
            const hamburgerMenu = document.querySelector('.hamburger-menu');
            const nav = document.getElementById('main-nav');

            if (loggedIn) {
                loginForm.style.display = 'none';
                hamburgerMenu.style.display = 'block';

                // ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€'console-page' ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¡¨ç¤º
                showPage('console-page');
            } else {
                loginForm.style.display = 'block';
                hamburgerMenu.style.display = 'none';
                nav.classList.remove('active');

                // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ã€ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã‚’éè¡¨ç¤ºã«ã™ã‚‹
                const pages = document.querySelectorAll('.page');
                pages.forEach(page => {
                    page.style.display = 'none';
                });
            }
        }

        // ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ãƒˆã‚°ãƒ«
        function toggleNav() {
            const nav = document.getElementById('main-nav');
            nav.classList.toggle('active');
        }

        // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, password })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loggedIn = true;
                        toggleDisplay();
                        connectWebSocket(username, password);
                    } else {
                        document.getElementById('login-error').innerText = 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
                    }
                })
                .catch(error => {
                    console.error('Login error:', error);
                    document.getElementById('login-error').innerText = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
                });
        }

        function connectWebSocket(username, password) {
            let wsUrl = 'wss://bfxmknk4-80.asse.devtunnels.ms/';
            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                console.log(`WebSocket connected to ${wsUrl}`);
                ws.send(JSON.stringify({ type: 'authenticate', username, password }));
            };

            ws.onmessage = handleWebSocketMessage;

            ws.onerror = (error) => {
                console.error(`WebSocket error on ${wsUrl}:`, error);
                ws.close();
                connectLocalWebSocket(username, password);
            };

            ws.onclose = (event) => {
                console.log(`WebSocket connection to ${wsUrl} closed`, event);
            };
        }

        function connectLocalWebSocket(username, password) {
            const localWsUrl = `ws://${window.location.host}`;
            console.log(`Trying to connect to local WebSocket server: ${localWsUrl}`);
            ws = new WebSocket(localWsUrl);

            ws.onopen = () => {
                console.log(`WebSocket connected to ${localWsUrl}`);
                ws.send(JSON.stringify({ type: 'authenticate', username, password }));
            };

            ws.onmessage = handleWebSocketMessage;

            ws.onerror = (error) => {
                console.error(`WebSocket error on ${localWsUrl}:`, error);
            };

            ws.onclose = () => {
                console.log(`WebSocket connection to ${localWsUrl} closed`);
            };
        }

        // WebSocket ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†ã™ã‚‹å…±é€šé–¢æ•°
        function handleWebSocketMessage(event) {
            const data = JSON.parse(event.data);
            switch (data.type) {
                case 'playerCount':
                    document.getElementById('playerCount').innerHTML = `<span class="info-icon">ğŸ‘¥</span> ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°: ${data.data}`;
                    document.getElementById('playerCount2').innerHTML = `<span class="info-icon">ğŸ‘¥</span> ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°: ${data.data}`;
                    break;
                case 'console':
                    const consoleElement = document.getElementById('console');
                    consoleElement.value += data.data + '\n';
                    consoleElement.scrollTop = consoleElement.scrollHeight;
                    break;
                case 'uptime':
                    document.getElementById('uptime').innerHTML = `<span class="info-icon">â±ï¸</span> èµ·å‹•æ™‚é–“: ${data.data}`;
                    document.getElementById('uptime2').innerHTML = `<span class="info-icon">â±ï¸</span> èµ·å‹•æ™‚é–“: ${data.data}`;
                    break;
                case 'onlinePlayers':
                    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚’æ›´æ–°
                    updatePlayerLists(data.data);
                    // æ—¢å­˜ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’æ›´æ–°ã™ã‚‹
                    updatePlayerPositions(data.data);
                    break;
                case 'error':
                    console.error('WebSocket error:', data.message);
                    if (data.message === 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ') {
                        loggedIn = false;
                        toggleDisplay();
                        ws.close();
                    }
                    break;
            }
        }

        // ã‚³ãƒãƒ³ãƒ‰é€ä¿¡
        function sendCommand() {
            if (!loggedIn || !ws) {
                alert('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            const command = document.getElementById('commandInput').value;
            ws.send(JSON.stringify({ type: 'command', command }));
            document.getElementById('commandInput').value = '';
        }

        // ã‚µãƒ¼ãƒãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
        function checkServerStatus() {
            fetch('/status')
                .then(response => response.json())
                .then(data => {
                    let statusHTML = '';
                    Object.keys(data).forEach(address => {
                        const serverData = data[address];
                        if (serverData.status === 'online') {
                            statusHTML += `<p><span class="status-icon">âœ”</span> ${address}: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</p>`;
                            statusHTML += `<p>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°: ${serverData.players.online} / ${serverData.players.max}</p>`;
                            statusHTML += `<p>MOTD: ${serverData.motd.clean.join('<br>')}</p>`;
                            if (typeof serverData.ping !== 'undefined') {
                                statusHTML += `<p>Ping: ${serverData.ping} ms</p>`;
                            }
                        } else if (serverData.status === 'offline') {
                            statusHTML += `<p><span class="status-icon offline">âœ–</span> ${address}: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³</p>`;
                        } else {
                            statusHTML += `<p><span class="status-icon error">âš </span> ${address}: çŠ¶æ…‹ç¢ºèªã‚¨ãƒ©ãƒ¼</p>`;
                            statusHTML += `<p>ã‚¨ãƒ©ãƒ¼è©³ç´°: ${serverData.error}</p>`;
                        }
                    });

                    document.getElementById('server-status').innerHTML = statusHTML;
                })
                .catch(error => {
                    console.error('Status check error:', error);
                    document.getElementById('server-status').innerHTML = '<span class="status-icon error">âš </span> çŠ¶æ…‹ç¢ºèªä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
                });
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚’æ›´æ–°ãŠã‚ˆã³ã€æ–°è¦ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿½åŠ ã€é€€å‡ºãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‰Šé™¤
        function updatePlayerLists(newPlayers) {
            // æ–°ã—ã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
            newPlayers.forEach(newPlayer => {
                if (!currentPlayers.some(p => p.uuid === newPlayer.uuid)) {
                    currentPlayers.push(newPlayer);
                }
            });

            // é€€å‡ºã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å‰Šé™¤
            currentPlayers = currentPlayers.filter(p => newPlayers.some(np => np.uuid === p.uuid));

            // ãƒ­ã‚°ã‚¤ãƒ³IDãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚‚ä½¿ç”¨ã—ã¦ã‚½ãƒ¼ãƒˆ
            currentPlayers.sort((a, b) => {
                // ãƒ­ã‚°ã‚¤ãƒ³é †ã§æ¯”è¼ƒ
                if (a.loginOrder && b.loginOrder) {
                    if (a.loginOrder < b.loginOrder) return -1;
                    if (a.loginOrder > b.loginOrder) return 1;
                }

                // UUIDã§æ¯”è¼ƒ
                if (a.uuid < b.uuid) return -1;
                if (a.uuid > b.uuid) return 1;

                return 0;
            });

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚’æ›´æ–°
            updatePlayerList(currentPlayers);
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½ç½®æƒ…å ±ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function updatePlayerPositions(players) {
            players.forEach(player => {
                // æ—¢å­˜ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ¤œç´¢
                const existingPlayer = currentPlayers.find(p => p.uuid === player.uuid);
                if (existingPlayer) {
                    // ä½ç½®æƒ…å ±ã ã‘ã‚’æ›´æ–°
                    existingPlayer.position = player.position;
                }
            });

            // ãƒªã‚¹ãƒˆã®è¡¨ç¤ºã‚’æ›´æ–°
            updatePlayerList(currentPlayers);
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function updatePlayerList(players) {
            const playerList = document.getElementById('player-list');
            const playerList2 = document.getElementById('player-list2'); // player-list2 ã‚’å–å¾—
            playerList.innerHTML = '';
            playerList2.innerHTML = ''; // player-list2 ã®å†…å®¹ã‚‚ã‚¯ãƒªã‚¢

            if (players.length === 0) {
                const emptyMessage = document.createElement('li');
                emptyMessage.textContent = "ç¾åœ¨ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã„ã¾ã›ã‚“";
                playerList.appendChild(emptyMessage);
                playerList2.appendChild(emptyMessage.cloneNode(true)); // åŒã˜è¦ç´ ã‚’ player-list2 ã«ã‚‚è¿½åŠ 
            } else {
                players.forEach(player => {
                    const li = document.createElement('li');
                    li.innerHTML = `<strong>${player.name}</strong> (UUID: ${player.uuid})`;
                    if (player.position) {
                        li.innerHTML += `<br>ä½ç½®: X=${player.position.x}, Y=${player.position.y}, Z=${player.position.z}`;
                    } else {
                        li.innerHTML += `<br>ä½ç½®: ä¸æ˜`;
                    }

                    playerList.appendChild(li);
                    playerList2.appendChild(li.cloneNode(true)); // li ã®ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ player-list2 ã«ã‚‚è¿½åŠ 
                });
            }
        }

        // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒˆã‚°ãƒ«
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('active');
        }

        // åˆæœŸè¡¨ç¤º
        toggleDisplay();
    </script>
</body>

</html>